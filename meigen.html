<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AI Cross-Language Misguided Quote Generator</title>
  <style>
    body { font-family: sans-serif; line-height: 1.6; padding: 2em; }
    #status { color: #888; font-style: italic; }
    #result-area { margin-top: 1em; padding: 1em; border: 1px solid #ccc; background-color: #f9f9f9; }
    h3 { margin-bottom: 0.5em; }
    p { margin-top: 0.2em; }
  </style>
</head>
<body>
  <h1>AIが英語で考え、日本語に翻訳する迷言ジェネレーター</h1>
  <p>ボタンを押すと、AIが迷言を生成し、日本語に翻訳します。</p>
  <p id="status">ステータス：待機中（初回クリック時はAIモデルのダウンロードに数分かかることがあります）</p>

  <button id="generate">迷言を生成する</button>

  <div id="result-area" style="display:none;">
    <h3>生成された迷言（原文: 英語）</h3>
    <p id="result-en"></p>
    <h3>翻訳結果（日本語）</h3>
    <p id="result-ja"></p>
  </div>

  <!-- Transformers.jsをCDNから読み込む -->
  <script type="module">
    // ES Module版のTransformers.jsをインポート
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';

    // HTML要素の取得
    const generateButton = document.getElementById('generate');
    const statusBar = document.getElementById('status');
    const resultArea = document.getElementById('result-area');
    const resultEn = document.getElementById('result-en');
    const resultJa = document.getElementById('result-ja');

    // 生成の元となる英語のプロンプト（命令文）リスト
    const prompts = [
      "Generate a profound but useless quote about life.",
      "Generate a weirdly motivational quote about potatoes.",
      "Generate a nonsensical quote that sounds like it's from a fantasy novel.",
      "Generate a philosophical quote about the meaning of a semicolon in programming.",
      "Generate a quote about finding true happiness in a pile of laundry.",
    ];

    generateButton.addEventListener('click', async () => {
      // 処理中の表示
      generateButton.disabled = true;
      resultArea.style.display = 'none';
      statusBar.textContent = 'ステータス：英語生成AIモデルを準備中です...（初回は時間がかかります）';

      // --- ステップ1: 英語の迷言を生成 ---
      // テキスト生成モデル（distilgpt2はGPT-2の小型版）のパイプラインを準備
      const generator = await pipeline('text-generation', 'Xenova/distilgpt2');
      
      // プロンプトをランダムに選択
      const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
      statusBar.textContent = `ステータス：英語で迷言を生成中... (プロンプト: ${randomPrompt})`;

      // 英語のテキストを生成
      const outputEn = await generator(randomPrompt, {
        max_new_tokens: 50, // 新しく生成するトークン（単語のようなもの）の最大数
        no_repeat_ngram_size: 2, // 同じフレーズの繰り返しを防ぐ
      });
      const generatedTextEn = outputEn[0].generated_text;

      // 英語の結果を先に表示
      resultEn.textContent = generatedTextEn;
      resultArea.style.display = 'block';

      // --- ステップ2: 日本語に翻訳 ---
      statusBar.textContent = 'ステータス：翻訳AIモデルを準備中です...';

      // 英語→日本語の翻訳パイプラインを準備
      const translator = await pipeline('translation', 'Xenova/opus-mt-en-jap');
      
      statusBar.textContent = 'ステータス：日本語に翻訳中...';
      
      // 翻訳を実行
      const outputJa = await translator(generatedTextEn);
      
      // 翻訳結果を表示
      resultJa.textContent = outputJa[0].translation_text;

      // 完了
      statusBar.textContent = 'ステータス：生成完了！';
      generateButton.disabled = false;
    });
  </script>
</body>
</html>
