<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ—¥çµŒå¹³å‡ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(120deg, #1b2735, #090a0f);
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 { color: #ffcc00; }
    #price {
      font-size: 2em;
      margin: 20px 0;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      background: #0078ff;
      color: #fff;
      transition: background 0.2s;
    }
    button:hover { background: #005fcc; }
    #balance, #holdings { font-size: 1.2em; margin: 10px; }
    .log {
      margin-top: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ˆ æ—¥çµŒå¹³å‡ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </h1>
  <div id="price">ç¾åœ¨ä¾¡æ ¼: å–å¾—ä¸­...</div>

  <!-- âœ… åˆæœŸæ®‹é«˜ã‚’100ä¸‡å††ã«å¤‰æ›´ -->
  <div id="balance">æ®‹é«˜: 1,000,000 å††</div>

  <div id="holdings">ä¿æœ‰æ ªæ•°: 0 æ ª</div>

  <button id="buyBtn">è²·ã†</button>
  <button id="sellBtn">å£²ã‚‹</button>
  <button id="refreshBtn">ä¾¡æ ¼æ›´æ–°</button>
  <div class="log" id="log"></div>

  <script>
    const API_KEY = "48584f0adfmsh0b16f34621e2ec5p10dce1jsn5bd220891dad"; // â†RapidAPIã‚­ãƒ¼ã‚’å…¥åŠ›
    const API_HOST = "yahoo-finance15.p.rapidapi.com";

    let balance = 1000000; // âœ… åˆæœŸæ®‹é«˜ï¼š100ä¸‡å††
    let holdings = 0;
    let currentPrice = 0;

    const priceEl = document.getElementById("price");
    const balanceEl = document.getElementById("balance");
    const holdingsEl = document.getElementById("holdings");
    const logEl = document.getElementById("log");

    async function fetchPrice() {
      priceEl.textContent = "ç¾åœ¨ä¾¡æ ¼: å–å¾—ä¸­...";
      try {
        const res = await fetch(`https://${API_HOST}/api/yahoo/ne/n225`, {
          method: "GET",
          headers: {
            "x-rapidapi-key": API_KEY,
            "x-rapidapi-host": API_HOST
          }
        });
        const data = await res.json();
        
        if (data && data.price) {
          currentPrice = parseFloat(data.price);
          priceEl.textContent = `ç¾åœ¨ä¾¡æ ¼: ${currentPrice.toLocaleString()} å††`;
          log(`ğŸ’¹ ä¾¡æ ¼æ›´æ–°: ${currentPrice.toLocaleString()} å††`);
        } else {
          priceEl.textContent = "ä¾¡æ ¼å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";
        }
      } catch (err) {
        console.error(err);
        priceEl.textContent = "ã‚¨ãƒ©ãƒ¼: ä¾¡æ ¼ã‚’å–å¾—ã§ãã¾ã›ã‚“";
      }
    }

    function buy() {
      if (currentPrice === 0) return alert("ä¾¡æ ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„ï¼");
      if (balance >= currentPrice) {
        balance -= currentPrice;
        holdings += 1;
        updateDisplay();
        log(`ğŸŸ¢ è²·ã„: ${currentPrice.toLocaleString()} å††`);
      } else {
        alert("æ®‹é«˜ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
      }
    }

    function sell() {
      if (holdings > 0) {
        balance += currentPrice;
        holdings -= 1;
        updateDisplay();
        log(`ğŸ”´ å£²ã‚Š: ${currentPrice.toLocaleString()} å††`);
      } else {
        alert("æ ªã‚’æŒã£ã¦ã„ã¾ã›ã‚“ï¼");
      }
    }

    function updateDisplay() {
      balanceEl.textContent = `æ®‹é«˜: ${balance.toLocaleString()} å††`;
      holdingsEl.textContent = `ä¿æœ‰æ ªæ•°: ${holdings} æ ª`;
    }

    function log(msg) {
      const p = document.createElement("p");
      const now = new Date().toLocaleTimeString("ja-JP");
      p.textContent = `[${now}] ${msg}`;
      logEl.prepend(p);
    }

    document.getElementById("buyBtn").addEventListener("click", buy);
    document.getElementById("sellBtn").addEventListener("click", sell);
    document.getElementById("refreshBtn").addEventListener("click", fetchPrice);

    fetchPrice();
  </script>
</body>
</html>
