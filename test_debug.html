<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Debug Test</title>
</head>
<body>
<script>
const PAIRS = [
  { id: '1', q: 'What is 2 + 2?', a: '4' },
  { id: '2', q: 'Capital of France?', a: 'Paris' },
  { id: '3', q: 'H2O is?', a: 'Water' },
  { id: '4', q: 'Opposite of hot?', a: 'Cold' },
  { id: '5', q: 'Primary color: red + blue = ?', a: 'Purple' },
  { id: '6', q: '10 / 2 = ?', a: '5' },
  { id: '7', q: 'Largest planet?', a: 'Jupiter' },
  { id: '8', q: 'HTML stands for?', a: 'HyperText Markup Language' }
];

const allIds = PAIRS.map(p => String(p.id));
let questionSlots = ['8', '7', '3', '6', '1', '4'];
let answerSlots = ['6', '4', '7', '8', '1', '3'];
let questionPool = [];
let answerPool = [];

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function removeFromArray(arr, value) {
  const idx = arr.indexOf(value);
  if (idx >= 0) arr.splice(idx, 1);
}

function rebuildPools() {
  const qActive = new Set(questionSlots);
  const aActive = new Set(answerSlots);
  questionPool = allIds.filter(id => !qActive.has(id));
  answerPool = allIds.filter(id => !aActive.has(id));
  shuffle(questionPool);
  shuffle(answerPool);
  console.log('rebuildPools - questionPool:', questionPool, 'answerPool:', answerPool);
}

function pickFromPool(pool, forbiddenSet) {
  for (let i = 0; i < pool.length; i++) {
    const id = pool[i];
    if (!forbiddenSet || !forbiddenSet.has(id)) {
      pool.splice(i, 1);
      console.log('pickFromPool - picked:', id, 'from pool:', pool);
      return id;
    }
  }
  return null;
}

// Simulate matching ID '3'
const matchedId = '3';
console.log('BEFORE: questionSlots:', questionSlots, 'answerSlots:', answerSlots);

removeFromArray(questionSlots, matchedId);
removeFromArray(answerSlots, matchedId);
console.log('AFTER REMOVE: questionSlots:', questionSlots, 'answerSlots:', answerSlots);

rebuildPools();

const qForbidden = new Set(questionSlots);
const newQ = pickFromPool(questionPool, qForbidden);
console.log('NEW Q:', newQ);
if (newQ) questionSlots.push(newQ);

const aForbidden = new Set(answerSlots);
let newA = null;
if (newQ) {
  const forbidJustNewQ = new Set([...aForbidden, newQ]);
  console.log('Trying to pick answer, forbidden:', Array.from(forbidJustNewQ));
  newA = pickFromPool(answerPool, forbidJustNewQ);
  if (!newA) {
    console.log('Fallback to just aForbidden');
    newA = pickFromPool(answerPool, aForbidden);
  }
} else {
  newA = pickFromPool(answerPool, aForbidden);
}
console.log('NEW A:', newA);
if (newA) answerSlots.push(newA);

console.log('FINAL: questionSlots:', questionSlots, 'answerSlots:', answerSlots);
console.log('NEW Q and NEW A are same?', newQ === newA);
</script>
</body>
</html>
